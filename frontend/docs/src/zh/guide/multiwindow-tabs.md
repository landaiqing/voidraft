# 多窗口与标签页

![多窗口占位](/img/placeholder-multiwindow.png)
> 替换为展示主窗口 + 侧边浮窗（子窗口）或标签页齐开的截图。

## 多窗口工作流
- `WindowService.OpenDocumentWindow` 会根据文档 ID 创建新 WebView 窗口，URL 自动附加 `?documentId=<id>`。
- `windowStore` 通过查询字符串判断当前是否为子窗口（非主窗口）。
- 子窗口具备：
  - 独立的 CodeMirror 实例与扩展栈。
  - 与主窗口共享的 Document/Config Store，因此编辑内容实时同步（SQLite 数据库为唯一来源）。
  - `WindowSnapService` 提供吸附：拖动靠近主窗口边缘时自动贴靠；支持上下左右以及四个角。
  - 关闭时自动注销吸附状态，避免悬挂引用。

### 操作步骤
1. 打开文档列表（工具栏图标或 `Ctrl+Shift+O`）。
2. 右键目标文档 → 选择 “在新窗口中打开”。
3. 若文档已在标签页打开，会自动从标签栏移除，防止重复。
4. 关闭窗口：
   - 点击自定义标题栏关闭按钮。
   - 系统托盘菜单选择退出。

### 使用建议
- 将参考资料或检查清单放在子窗口中，配合“窗口置顶”保持常驻。
- 通过 Windows Snap + voidraft Snap 组合，可快速排版 2-4 个窗口。
- 若想在多窗口之间同步滚动，可尝试启用“共享视图状态”扩展（计划中）。

## 标签页模式
- 在设置 > 通用中开启“启用标签页”（`config.general.enableTabs`）。
- `tabStore` 维护 `tabsMap` + `tabOrder`，支持：
  - 拖拽排序（拖动标签即可）。
  - 关闭单个/其他/左侧/右侧标签。
  - 检测当前文档是否已存在标签。
- 标签栏位于主窗口顶部，紧贴工具栏下方。

### 常用操作
| 操作 | 方法 |
| --- | --- |
| 关闭标签 | 点击标签上的叉号或中键 |
| 关闭其他 | 右键标签 → “关闭其他标签” |
| 关闭右侧/左侧 | 右键标签 → 选择对应菜单 |
| 固定标签（计划中） | 将在后续版本中提供 pin 功能 |

### Tabs vs 窗口
| 项目 | 标签页 | 新窗口 |
| --- | --- | --- |
| UI 占用 | 集成在一个窗口中 | 独立操作系统窗口 |
| 跨屏 | 不方便 | 可拖到其他显示器 |
| 独立置顶 | 不可单独置顶 | 每个窗口可单独置顶 |
| 推荐场景 | 同一背景的多个文档 | 跨项目/跨显示器对比 |

## 系统托盘与热键
- 勾选 “启用系统托盘” 后，关闭窗口默认隐藏至托盘。
- 全局热键（默认 `Alt+X`）由 `HotkeyService` 控制：
  - 若 main window 可见 → 隐藏所有 voidraft 窗口。
  - 若 main window 隐藏 → Show + Restore + Focus。
- `TrayService` 还提供“最小化到托盘”“显示主窗口”等菜单项。

## 常见问题
| 问题 | 原因 | 解决 |
| --- | --- | --- |
| 新窗口无法打开 | 文档 ID 不存在或被锁定 | 在文档列表确认状态，必要时解锁 |
| 子窗口未吸附 | WindowSnap 未启用 | 设置 > 通用 → 勾选“窗口吸附” |
| 关闭窗口直接退出应用 | 未启用托盘模式 | 设置 > 通用 → 启用系统托盘 |
| 标签页切换慢 | 同时开启标签 + 多窗口导致资源占用 | 关闭暂不需要的窗口或减少标签 |

> 如果需要更复杂的布局（如平铺窗口、快捷布局），欢迎在 Issue 中提出建议。
